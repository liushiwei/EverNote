--- 
title: 常用方法
tags: Android,Java
notebook: George 的笔记本
---

<!-- MarkdownTOC -->

- [AudioFocus](#audiofocus)
- [媒体扫描](#媒体扫描)
	- [获取Id3信息](#获取id3信息)
- [获取最上层Activity](#获取最上层activity)
- [写值到文件](#写值到文件)
- [修改默认输入法](#修改默认输入法)
- [Shared Preferences 数据存储](#shared-preferences-数据存储)
- [Setting provider 使用 Settings.System](#setting-provider-使用-settingssystem)
- [修改系统默认动画，去掉过场动画](#修改系统默认动画，去掉过场动画)

<!-- /MarkdownTOC -->

# AudioFocus 

```java
    AudioManager  mAm = (AudioManager) getSystemService(AUDIO_SERVICE);
    requestFocus();
    OnAudioFocusChangeListener afChangeListener = new OnAudioFocusChangeListener() {
                public void onAudioFocusChange(int focusChange) {
                 Log.e("MainActivity", " focusChange ="+focusChange);
                    if (focusChange == AudioManager.AUDIOFOCUS_LOSS_TRANSIENT) {
                        // Pause playback
                    } else if (focusChange == AudioManager.AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK) {
                        // Resume playback
                    } else if (focusChange == AudioManager.AUDIOFOCUS_GAIN) {
                        // Resume playback
                    } else if (focusChange == AudioManager.AUDIOFOCUS_LOSS) {
                        // mAm.unregisterMediaButtonEventReceiver(RemoteControlReceiver);
                        mAm.abandonAudioFocus(afChangeListener);
                        // Stop playback
                    }
                }
            };
           
            private boolean requestFocus() {
                // Request audio focus for playback
                int result = mAm.requestAudioFocus(afChangeListener,
                // Use the music stream.
                        AudioManager.STREAM_MUSIC,
                        // Request permanent focus.
                        AudioManager.AUDIOFOCUS_GAIN);
                return result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED;
            }

```
***

# 媒体扫描 
	位置	frameworks/av/media/libmedia/MediaScannerClient.cpp
## 获取Id3信息

```java
	void MediaScannerClient::endFile()
	{
	    if (mLocaleEncoding != kEncodingNone) {
	        int size = mNames->size();
	        uint32_t encoding = kEncodingAll;

	        // compute a bit mask containing all possible encodings
	        for (int i = 0; i < mNames->size(); i++)
	            encoding &= possibleEncodings(mValues->getEntry(i));
	        ALOGE("id3 get possible encoding = %d ,localEncoding = %d",encoding,mLocaleEncoding);
	        // if the locale encoding matches, then assume we have a native encoding.
	        if (encoding & mLocaleEncoding)
	            convertValues(mLocaleEncoding);
	        ALOGE("id3 convertValues");
	        // finally, push all name/value pairs to the client
	        for (int i = 0; i < mNames->size(); i++) {
	            status_t status = handleStringTag(mNames->getEntry(i), mValues->getEntry(i));
	             ALOGE("id3 info: %s - %s",mNames->getEntry(i), mValues->getEntry(i));
	            if (status) {
	                break;
	            }
	        }
	    }
	    // else addStringTag() has done all the work so we have nothing to do

	    delete mNames;
	    delete mValues;
	    mNames = NULL;
	    mValues = NULL;
	}

```
****

# 获取最上层Activity

```java
	public void checkTopActivity() {
		final ActivityManager activityManager = (ActivityManager)
				getSystemService(Context.ACTIVITY_SERVICE);
		List<RunningTaskInfo> newrunningtasks = activityManager.getRunningTasks(1);
		String foregroundApp = newrunningtasks.get(0).topActivity.getPackageName();
		Log.e("MainActivity", "top Activity ="+foregroundApp);
	}
```

# 写值到文件

```java
	private void setValue(String value, String file) {
		OutputStream out = null;
		try {
			out = new FileOutputStream(file);
			out.write(Byte.valueOf(value) + 48);
			out.close();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
```
****

# 修改默认输入法

* 用Dumpsys input_method 查询类名
* path: packages/SettingsProvider/res/values/defaults.xml

```xml
 <string name="config_default_input_method" translatable="false">com.iflytek.inputmethod.xiaomi/.FlyIME</string>
```

# Shared Preferences 数据存储

```java
	private SharedPreferences mSourcePreferences;

	mSourcePreferences = getSharedPreferences("source", 0);

	Editor editor = mSourcePreferences.edit();
        editor.putInt("mCurrentMediaSource", mCurrentMediaSource);
        editor.commit();
    //其它进程读取
    Context otherAppsContext;
		try {
			otherAppsContext = createPackageContext("com.carit.mediasourcemanager", Context.CONTEXT_IGNORE_SECURITY);
			SharedPreferences sharedPreferences = otherAppsContext.getSharedPreferences("source", Context.MODE_WORLD_READABLE);
			Log.e("TTT", "TTTT source ="+sharedPreferences.getInt("current_media_source", -1));
			
		} catch (NameNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
```

# Setting provider 使用 Settings.System

* path:frameworks/base/core/java/android/provider/Settings.java

* 在文件里首先需要定义一个系统属性值

```java
	public static final String SILVAN_LIU = "silvan_liu";  
	public static final String[] SETTINGS_TO_BACKUP ={  
        //
       +SILVAN_LIU  
        //     
	};
```

* 在AndroidManifest.xml中包含权限:

```xml
<uses-permission android:name="android.permission.WRITE_SETTINGS"/>

```


```java
	Settings.System.getInt(getContentResolver(), Settings.System.SILVAN_LIU,0);
	Settings.System.getInt(getContentResolver(), Settings.System.SILVAN_LIU,0);
	//添加监听
	mContext.getContentResolver().registerContentObserver(Settings.System.getUriFor(Settings.System.NANLOG_CLOCK_STYLE),
                false, mAnalogClockObserver);
	private ContentObserver mAnalogClockObserver = new ContentObserver(new Handler()) {
        @Override
        public void onChange(boolean selfChange) {
            int value = Settings.System.getInt(
                    mContext.getContentResolver(), Settings.System.NANLOG_CLOCK_STYLE, DEFAULT_ANALOG_CLOCK);
            android.util.Log.e("zhangshuli", "value==="+value);
            updateClockView(value);
        }

    };

```


***************


# 修改系统默认动画，去掉过场动画

	core/res/res/values/styles.xml

```xml
 <style name="Animation.Activity">
-        <item name="activityOpenEnterAnimation">@anim/activity_open_enter</item>
-        <item name="activityOpenExitAnimation">@anim/activity_open_exit</item>
-        <item name="activityCloseEnterAnimation">@anim/activity_close_enter</item>
-        <item name="activityCloseExitAnimation">@anim/activity_close_exit</item>
-        <item name="taskOpenEnterAnimation">@anim/task_open_enter</item>
-        <item name="taskOpenExitAnimation">@anim/task_open_exit</item>
-        <item name="taskCloseEnterAnimation">@anim/task_close_enter</item>
-        <item name="taskCloseExitAnimation">@anim/task_close_exit</item>
-        <item name="taskToFrontEnterAnimation">@anim/task_open_enter</item>
-        <item name="taskToFrontExitAnimation">@anim/task_open_exit</item>
-        <item name="taskToBackEnterAnimation">@anim/task_close_enter</item>
-        <item name="taskToBackExitAnimation">@anim/task_close_exit</item>
+        <item name="activityOpenEnterAnimation">@null</item>
+        <item name="activityOpenExitAnimation">@null</item>
+        <item name="activityCloseEnterAnimation">@null</item>
+        <item name="activityCloseExitAnimation">@null</item>
+        <item name="taskOpenEnterAnimation">@null</item>
+        <item name="taskOpenExitAnimation">@null</item>
+        <item name="taskCloseEnterAnimation">@null</item>
+        <item name="taskCloseExitAnimation">@null</item>
+        <item name="taskToFrontEnterAnimation">@null</item>
+        <item name="taskToFrontExitAnimation">@null</item>
+        <item name="taskToBackEnterAnimation">@null</item>
+        <item name="taskToBackExitAnimation">@null</item>
```
